# 定时任务
## at
如果想在linux下计划在将来的某个时刻执行某些命令，可以通过atd服务实现此功能。
1、使用linux 的atd服务之前首先确认atd服务是否开启，可以通过“/etc/init.d/atd status”命令查看服务的运行状态。
2、使用命令“at now+2 minutes”命令编写一个两分钟之后要执行的命令。比如2分钟之后执行查看系统当前时间命令。
3、at计划任务的时间格式可以分为“具体时间日期格式【04:00 2014-01-18】”、“模糊词语格式【midnight、noon、teatime】”、“相对计时法【now + 多少+时间单位】”
4、使用atq可以查询到已添加的at计划任务。
5、使用atrm命令可以将已添加的未执行计划任务删除，格式为“atrm 任务号”比如：“atrm 4”。
6、可以通过在/etc/at.deny和at.allow里边配置那个用户可以使用at命令.

```sh
➜  ~ at now +2 minutes
at> date
at> <EOT> # crtl + d 退出
job 5 at 2017-06-30 12:48
➜  ~ atq
5       2017-06-30 12:48 a zhuyin
➜  ~ artm 4
zsh: command not found: artm
➜  ~ atrm 4
Cannot find jobid 4
➜  ~ atrm 5
```
## crontab
通过crontab 命令，我们可以在固定的间隔时间执行指定的系统指令或 shell script脚本。时间间隔的单位可以是分钟、小时、日、月、周及以上的任意组合。这个命令非常设合周期性的日志分析或数据备份等工作。
命令格式：

```shell
crontab [-u user] file
crontab [-u user] [ -e | -l | -r ]
```
命令参数：

    -u user：用来设定某个用户的crontab服务，例如，“-u ixdba”表示设定ixdba用户的crontab服务，此参数一般有root用户来运行。
    file：file是命令文件的名字,表示将file做为crontab的任务列表文件并载入crontab。如果在命令行中没有指定这个文件，crontab命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab。
    -e：编辑某个用户的crontab文件内容。如果不指定用户，则表示编辑当前用户的crontab文件。
    -l：显示某个用户的crontab文件内容，如果不指定用户，则表示显示当前用户的crontab文件内容。
    -r：从/var/spool/cron目录中删除某个用户的crontab文件，如果不指定用户，则默认删除当前用户的crontab文件。
    -i：在删除用户的crontab文件时给确认提示。

用户所建立的crontab文件中，每一行都代表一项任务，每行的每个字段代表一项设置，它的格式共分为六个字段，前五段是时间设定段，第六段是要执行的命令段，格式如下：

    minute   hour   day   month   week   command
其中：

    minute： 表示分钟，可以是从0到59之间的任何整数。
    hour：表示小时，可以是从0到23之间的任何整数。
    day：表示日期，可以是从1到31之间的任何整数。
    month：表示月份，可以是从1到12之间的任何整数。
    week：表示星期几，可以是从0到7之间的任何整数，这里的0或7代表星期日。
    command：要执行的命令，可以是系统命令，也可以是自己编写的脚本文件。 

在以上各个字段中，还可以使用以下特殊字符：

    星号（*）：代表所有可能的值，例如month字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作。
    逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”
    中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”
    正斜线（/）：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。同时正斜线可以和星号一起使用，例如*/10，如果用在minute字段，表示每十分钟执行一次。
Linux在相应用户下，用crontab －l 命令可以查看该用户定时执行的任务，-e可以编辑，但是其真实文件在哪儿呢？
> 以CentOS为例，其真实的位置在：/var/spool/cron下面

示例：

```shell
5 * * * * /usr/sbin/ntpdate -v -u 192.43.244.18 210.72.145.44  210.0.235.14  59.124.196.84 &>/dev/null
```
